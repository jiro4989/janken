# 要件定義

## 概要

じゃんけんサービスの目的とシステム全体の概要、開発方針などを記載する

## じゃんけんサービスについて

じゃんけんをWebページ上で行えるようにするサービスと定義する。

### 目的

このシステムで何かの課題を解決したい、新しいユーザ体験を提供したいといった意図は
なく、開発者のシステム構築の経験値を積むことだけを目的とする。

学習することが最大の目的であり、
納期、工数、サービス自体の存在意義については考慮しないものとする。

### 一般的なじゃんけんの定義

世間一般に定義されるじゃんけんの仕様は下記の通り。

1. 出す手は「ぐー」「ちょき」「ぱー」の3つ
1. ぐー > ちょき > ぱー > ぐー の順で、相手の手には勝つことができる
1. 同じ手を出した場合はあいことして再度互いに手を出し合う
1. じゃんけんをプレイするには最大で2人以上必要であるが、人数上限はない

### このプロジェクトにおけるじゃんけんサービスの仕様

1. 自分の対戦相手として、Webシステムが存在する
1. Webブラウザで特定URLにアクセスすることで、Webシステムからじゃんけんの手が返る
1. じゃんけんの手は毎秒更新する
1. 勝敗の判定はブラウザ側JSにて行い、画面に結果を表示する
1. 画面のデザインの斬新さ、見やすさなどは考慮しない

## システム構成

システムはAmazon Web Service(以降AWS)を使用してクラウドWebアプリとして構築する。
以下の図にシステム構成を示す。

![システム構成図](system_structure.png)

### 追加インストールパッケージ

| 名称         | バージョン | 概要                  | 使用用途                         |
|--------------|------------|-----------------------|----------------------------------|
| Go           | 1.10       | プログラミング言語    | じゃんけんHTMLの生成に使用する   |
| Apache httpd | 2.4        | webサーバソフトウェア | httpリクエストを受けてHTMLを返す |

### 全体ロジック

以下にブラウザにて特定URLにアクセスして、結果が画面に表示されるまでのフローを記
す。

![じゃんけんフロー](janken_flow.png)

## 開発方針

1. 開発は1名でアプリ、インフラ両方を構築する
1. 固定値などをハードコードせず、設定ファイル、環境変数などに定義する
1. 開発環境、本番環境などの区別はせず1環境のみ用意するが、本番環境を追加で用意す
   る場合も考慮した構成とする
1. リリースは専用のデプロイツールなどを使用した自動/半自動でのリリースのみとし、
   手動デプロイなどは行わない。
1. リリースに失敗した場合のリカバリープランも用意するものとする

## 運用

1. 問題調査のために、アプリはログをファイルに記録する
1. 出力するログには適切なログレベルを設定する
1. コスト削減のため、ログは一週間でローテートし、S3に14日間保管する
1. アプリの処理時間をCloudWatchに記録して可視化する
1. リリース手順書など、運用で必要な手順はドキュメント化する

## セキュリティ対策方針

1. AWSよりセキュリティアップデートなどの情報が告知された場合は
   速やかにパッチを適用する。
1. 不要なポートは開けず、必要最低限のポートとネットワークレンジに制限する
1. サーバ内のファイルアクセス権限、プログラム実行権限を適切に設定する
1. ミドルウェアの設定を適切に設定し、設定値を変更する場合はその意図を明記する

## 可用性、拡張性、耐障害性

AWSを利用することでストレージ、インスタンスタイプのスケーラビリティを確保するが
冗長化については考慮しないものとする。
これはサーバがダウンした際は、手動復旧、あるいはAWS側での自動復旧がないかぎりサ
ービスが停止することを意味する。

冗長化構成を取らないことの対策として、CloudWatch監視とAmazon SNSを利用して
障害発生時はメール通知をする仕組みを導入し、サービスを可能な限り早く復旧するもの
とする。

